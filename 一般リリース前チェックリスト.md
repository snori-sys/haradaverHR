# 一般リリース前チェックリスト

## ⚠️ リリース前の最終確認

一般リリース（本番環境への一般公開）する前に、以下の項目を確認してください。

## 📋 必須確認項目

### 1. セキュリティ設定

#### 環境変数の確認
- [x] ✅ `NEXT_PUBLIC_SUPABASE_URL` が本番環境のSupabase URLであること
- [x] ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY` が本番環境のanon keyであること
- [x] ✅ `SUPABASE_SERVICE_ROLE_KEY` が本番環境のservice_role keyであること
- [x] ✅ `JWT_SECRET` が強力なランダム文字列であること（32文字以上）
- [x] ✅ `JWT_EXPIRES_IN` が適切に設定されていること（`24h`）

#### データベースセキュリティ
- [ ] ⚠️ **RLSポリシーを本番環境用に更新**（重要）
  - 現在、開発用のRLSポリシー（すべてのアクセスを許可）が設定されています
  - 本番環境では、より厳格なRLSポリシーを適用することを推奨
  - `supabase/point-card-schema-production.sql` を実行して更新可能

#### データベースパスワード
- [ ] ✅ Supabaseプロジェクトのデータベースパスワードを安全に保管

### 2. データベース設定

#### テーブルの確認
- [x] ✅ すべてのテーブルが作成されている（7つ）
  - `customers`
  - `casts`
  - `visits`
  - `point_transactions`
  - `settings`
  - `alerts`
  - `admin_users`

#### 初期設定データ
- [x] ✅ `settings`テーブルに初期設定データが存在する
  - `point_rate`: `3`
  - `min_points_to_use`: `500`
  - `point_unit`: `500`
  - `alert_email`: （空でもOK）
  - `alert_days`: `90`

#### インデックスとトリガー
- [x] ✅ インデックスが作成されている
- [x] ✅ トリガーが設定されている（ポイント自動更新など）

### 3. アプリケーション設定

#### ビルド設定
- [x] ✅ ビルドが成功する
- [x] ✅ TypeScriptのエラーがない
- [x] ✅ 依存関係が正しくインストールされる

#### 環境変数の設定
- [x] ✅ Vercelで5つの環境変数が設定されている
- [x] ✅ すべての環境変数で「All Environments」が選択されている

### 4. 動作確認

#### 基本機能
- [ ] ⚠️ **顧客登録が動作する**（`/register`）
- [ ] ⚠️ **顧客ログインが動作する**（`/login`）
- [ ] ⚠️ **顧客ダッシュボードが表示される**（`/dashboard`）

#### 管理者機能
- [ ] ⚠️ **管理者登録が動作する**（`/admin/register`）
- [ ] ⚠️ **管理者ログインが動作する**（`/admin/login`）
- [ ] ⚠️ **管理者ダッシュボードが表示される**（`/admin/dashboard`）

#### 管理機能
- [ ] ⚠️ **来店履歴管理が動作する**（`/admin/visits`）
- [ ] ⚠️ **キャスト管理が動作する**（`/admin/casts`）
- [ ] ⚠️ **アラート管理が動作する**（`/admin/alerts`）
- [ ] ⚠️ **設定管理が動作する**（`/admin/settings`）

### 5. パフォーマンス

#### ページの読み込み速度
- [ ] ⚠️ ページが適切な速度で読み込まれる

#### データベースの接続
- [ ] ⚠️ Supabaseへの接続が安定している

### 6. エラーハンドリング

#### エラーメッセージ
- [ ] ⚠️ エラーメッセージに機密情報が含まれていない

#### エラーログ
- [ ] ⚠️ エラーが適切に記録されている

## ⚠️ 推奨される追加設定

### 1. RLSポリシーの更新（重要）

現在、開発用のRLSポリシー（すべてのアクセスを許可）が設定されています。

本番環境では、より厳格なRLSポリシーを適用することを強く推奨します：

1. **SupabaseダッシュボードでSQL Editorを開く**
2. **`supabase/point-card-schema-production.sql` の内容を実行**

これにより、本番環境用のRLSポリシーが適用されます。

### 2. 初期管理者アカウントの作成

本番環境で管理者アカウントを作成することを推奨します：

1. **デプロイURLにアクセス**
   - https://cmsbeppin.vercel.app

2. **管理者登録ページにアクセス**
   - https://cmsbeppin.vercel.app/admin/register

3. **初期管理者アカウントを作成**

### 3. カスタムドメインの設定（オプション）

必要に応じて、カスタムドメインを設定できます：

1. **Vercelダッシュボードでプロジェクトを開く**
2. **Settings → Domains** をクリック
3. **カスタムドメインを追加**

### 4. バックアップ設定（推奨）

Supabaseでバックアップを有効にすることを推奨します：

1. **Supabaseダッシュボードでプロジェクトを開く**
2. **Settings → Database → Backups** を確認
3. **必要に応じてバックアップを設定**

## ✅ リリース準備完了の確認

### 必須項目
- [x] ✅ データベーススキーマが実行されている
- [x] ✅ すべてのAPIキーが取得されている
- [x] ✅ 環境変数が設定されている
- [x] ✅ ビルドが成功している
- [x] ✅ アプリケーションが正常に表示される

### 推奨項目
- [ ] ⚠️ RLSポリシーを本番環境用に更新（推奨）
- [ ] ⚠️ すべての機能が動作することを確認（推奨）
- [ ] ⚠️ 初期管理者アカウントを作成（推奨）

## 🚀 リリース判定

### 必須項目がすべて完了している場合

**✅ リリース可能**: 基本的なリリース準備は完了しています。

ただし、以下を推奨します：
1. **すべての機能を動作確認**
2. **RLSポリシーを本番環境用に更新**（セキュリティのため）
3. **初期管理者アカウントを作成**

### 推奨項目も完了している場合

**✅ リリース推奨**: すべての準備が完了しています。一般リリースして問題ありません。

## 📋 リリース後の確認

リリース後、以下を確認してください：

1. **動作確認**
   - すべての機能が正常に動作するか確認

2. **エラーログの確認**
   - Vercelのログを確認
   - エラーが発生していないか確認

3. **セキュリティの確認**
   - 未認証ユーザーが保護されたページにアクセスできないか確認
   - データが適切に保護されているか確認

## 🎉 リリース完了

すべての確認が完了したら、一般リリースして問題ありません！

## 📝 今後のメンテナンス

定期的に以下を確認してください：

1. **Supabaseの使用状況**
   - データベース容量
   - APIリクエスト数

2. **Vercelの使用状況**
   - ビルド時間
   - エラーログ

3. **セキュリティの更新**
   - 依存関係の更新
   - セキュリティパッチの適用

お疲れ様でした！一般リリース準備が完了しています！

